#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <seccomp.h>
#include <pthread.h>
#include <dlfcn.h>

// testing the behaviour of mmap
// and aslr on shared objects


#define __mmap(size) mmap(0, size, PROT_READ | PROT_WRITE, MAP_ANONYMOUS | MAP_PRIVATE, -1, 0)

void * fct(void * arg){

    int b = 7;
}

int main(){

    //scmp_filter_ctx a = seccomp_init(0);

    //pthread_t thr;
    //pthread_create(&thr, NULL, fct, NULL);

    void * slib = dlopen("/usr/lib/x86_64-linux-gnu/libseccomp.so.2.5.1", RTLD_NOW);

    char * p;

    //p = __mmap(0x100000);

    //p = __mmap(0x1000);

    void * thrlib = dlopen("/usr/lib/x86_64-linux-gnu/libpthread-2.31.so", RTLD_NOW);

    p = __mmap(0x10000);

    p = __mmap(0x1000);

    p = __mmap(0x10000);

    p = __mmap(0x100000);

    return 0;
}